import"../styles/styles.css";import App from"../scripts/pages/app";import("./utils/push-notification").then((e=>{e.registerServiceWorker().catch((()=>{}))})),window.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),window.deferredPrompt=e})),document.addEventListener("DOMContentLoaded",(()=>{new App({content:document.querySelector("#main-content"),drawerButton:document.querySelector("#drawer-button"),navigationDrawer:document.querySelector("#navigation-drawer")});const e=document.querySelector(".skip-to-content"),i=document.querySelector("#main-content");e&&i&&e.addEventListener("click",(e=>{e.preventDefault(),i.setAttribute("tabindex","-1"),i.focus(),i.scrollIntoView({behavior:"smooth"})})),import("./utils/push-notification").then((e=>{const i=document.getElementById("pushNotifBtn");function t(e){e?(i.textContent="Nonaktifkan Notifikasi",i.classList.remove("subscribe"),i.classList.add("unsubscribe"),i.innerHTML='<i data-feather="bell-off"></i> Nonaktifkan Notifikasi'):(i.textContent="Aktifkan Notifikasi",i.classList.remove("unsubscribe"),i.classList.add("subscribe"),i.innerHTML='<i data-feather="bell"></i> Aktifkan Notifikasi'),window.feather&&window.feather.replace()}async function a(){if(localStorage.getItem("accessToken")){i.style.display="inline-block",i.disabled=!0;try{await navigator.serviceWorker.ready,t(await e.isPushSubscribed()),i.disabled=!1}catch(e){i.disabled=!0,t(!1),console.error("[PushNotif] Service worker not ready:",e)}}else i.style.display="none"}i&&(i.addEventListener("click",(async()=>{const t=localStorage.getItem("accessToken");if(t){i.disabled=!0;try{if("denied"===Notification.permission)return alert("Izin notifikasi ditolak. Silakan aktifkan izin notifikasi di browser Anda."),void(i.disabled=!1);if(await navigator.serviceWorker.ready,await e.isPushSubscribed())await e.unsubscribePushNotification(t);else{if("granted"!==Notification.permission&&"granted"!==await Notification.requestPermission())return alert("Izin notifikasi diperlukan untuk mengaktifkan push notification."),void(i.disabled=!1);await e.subscribePushNotification(t)}}catch(e){alert("Gagal mengubah status notifikasi: "+(e.message||e)),console.error("[PushNotif] Error:",e)}await a(),i.disabled=!1}else alert("Silakan login untuk mengaktifkan notifikasi.")})),window.addEventListener("hashchange",a),a())}))}));