import routes from"../routes/routes.js";import{getActiveRoute}from"../routes/url-parser.js";import{withViewTransition}from"../utils/view-transition.js";class App{#e=null;#t=null;#n=null;constructor({navigationDrawer:e,drawerButton:t,content:n}){this.#e=n,this.#t=t,this.#n=e,this._setupDrawer(),this._setupRouter(),window.location.hash||(window.location.hash="#/")}_setupDrawer(){this.#t.addEventListener("click",(()=>{this.#n.classList.toggle("open")})),document.body.addEventListener("click",(e=>{this.#n.contains(e.target)||this.#t.contains(e.target)||this.#n.classList.remove("open"),this.#n.querySelectorAll("a").forEach((t=>{t.contains(e.target)&&this.#n.classList.remove("open")}))}))}_setupRouter(){window.addEventListener("hashchange",(()=>this.renderPage())),window.addEventListener("load",(()=>this.renderPage()))}async renderPage(){try{this.#a&&"function"==typeof this.#a.cleanup&&await this.#a.cleanup();const e=getActiveRoute(),t=routes[e]||null;if(!t){const e=new(0,(await import("../views/NotFoundView.js")).default);return this.#e.innerHTML=await e.render(),void(this.#a=null)}const n=!!localStorage.getItem("accessToken");if(t.requiresAuth&&!n)return window.location.hash="#/login",void(this.#a=null);this._updateNav(n),this.#a=t.page;const a=async()=>{this.#e.innerHTML=await t.page.render(),"function"==typeof t.page.afterRender&&await t.page.afterRender();const e=document.querySelector("#main-content");e&&e.setAttribute("tabindex","-1")};await withViewTransition((async()=>{await a()}))}catch(e){console.error("Error saat merender halaman:",e),this.#e.innerHTML="<p>Terjadi kesalahan saat memuat halaman.</p>",this.#a=null}}#a=null;_updateNav(e){const t=document.querySelector("#loginLink"),n=document.querySelector("#logoutButton"),a=document.querySelector("#addStoryLink"),r=document.querySelector("#savedStoriesLink");t&&(t.style.display=e?"none":"inline-block"),a&&(a.style.display=e?"inline-block":"none"),n&&(n.style.display=e?"inline-block":"none"),r&&(r.style.display=e?"inline-block":"none"),n&&(n.onclick=()=>{localStorage.removeItem("accessToken"),window.location.hash="#/login"})}}export default App;