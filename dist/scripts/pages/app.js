import routes from"../routes/routes.js";import{getActiveRoute}from"../routes/url-parser.js";import{withViewTransition}from"../utils/view-transition.js";class App{#t=null;#e=null;#n=null;constructor({navigationDrawer:t,drawerButton:e,content:n}){this.#t=n,this.#e=e,this.#n=t,this._insertSkipLink(),this._setupDrawer(),this._setupRouter(),window.location.hash||(window.location.hash="#/")}_insertSkipLink(){const t=document.createElement("a");t.href="#main-content",t.textContent="Skip to content",t.classList.add("skip-to-content"),document.body.insertBefore(t,document.body.firstChild)}_setupDrawer(){this.#e.addEventListener("click",(()=>{this.#n.classList.toggle("open")})),document.body.addEventListener("click",(t=>{this.#n.contains(t.target)||this.#e.contains(t.target)||this.#n.classList.remove("open"),this.#n.querySelectorAll("a").forEach((e=>{e.contains(t.target)&&this.#n.classList.remove("open")}))}))}_setupRouter(){window.addEventListener("hashchange",(()=>this.renderPage())),window.addEventListener("load",(()=>this.renderPage()))}async renderPage(){try{this.#a&&"function"==typeof this.#a.cleanup&&await this.#a.cleanup();const t=getActiveRoute(),e=routes[t]||null;if(!e){const t=new(0,(await import("../views/NotFoundView.js")).default);return this.#t.innerHTML=await t.render(),void(this.#a=null)}const n=!!localStorage.getItem("accessToken");if(e.requiresAuth&&!n)return window.location.hash="#/login",void(this.#a=null);this._updateNav(n),this.#a=e.page;const a=async()=>{this.#t.innerHTML=await e.page.render(),"function"==typeof e.page.afterRender&&await e.page.afterRender();const t=document.querySelector("#main-content");t&&t.setAttribute("tabindex","-1")};await withViewTransition((async()=>{await a()}))}catch(t){console.error("Error saat merender halaman:",t),this.#t.innerHTML="<p>Terjadi kesalahan saat memuat halaman.</p>",this.#a=null}}#a=null;_updateNav(t){const e=document.querySelector("#loginLink"),n=document.querySelector("#logoutButton"),a=document.querySelector("#addStoryLink");e&&(e.style.display=t?"none":"inline-block"),a&&(a.style.display=t?"inline-block":"none"),n&&(n.style.display=t?"inline-block":"none"),n&&(n.onclick=()=>{localStorage.removeItem("accessToken"),window.location.hash="#/login"})}}export default App;